<engine port="61063" name="Intel_DZ">
  <projects>
    <project name="Sensors" pubsub="auto" threads="1">
      <contqueries>
        <contquery name="CQ1">
          <windows>
            <window-source name="Data_Stream" pubsub="true" collapse-updates="true">
              <schema>
                <fields>
                  <field name="id" type="string" key="true"/>
                  <field name="location" type="string" key="true"/>
                  <field name="timestamp" type="stamp"/>
                  <field name="sound" type="double"/>
                  <field name="light" type="double"/>
                  <field name="distance" type="double"/>
                  <field name="temperature" type="double"/>
                  <field name="humidity" type="double"/>
                </fields>
              </schema>
            </window-source>
            <window-copy name="retain_15records" pubsub="true" collapse-updates="true">
              <retention type="bycount_sliding">15 seconds</retention>
            </window-copy>
            <window-aggregate name="sound_agg" pubsub="true" collapse-updates="true">
              <schema>
                <fields>
                  <field name="location" type="string" key="true"/>
                  <field name="sound_std" type="double"/>
                  <field name="sound_avg" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[ESP_aStd(sound)]]></field-expr>
                <field-expr><![CDATA[ESP_aAve(sound)]]></field-expr>
              </output>
            </window-aggregate>
            <window-join name="sound_join" index="pi_EMPTY" collapse-updates="true">
              <join type="leftouter" no-regenerates="true">
                <conditions>
                  <fields left="location" right="location"/>
                </conditions>
              </join>
              <output>
                <field-selection name="ID" source="l_id"/>
                <field-selection name="timestamp" source="l_timestamp"/>
                <field-selection name="sound" source="l_sound"/>
                <field-selection name="sound_forecast" source="r_sound_avg"/>
                <field-selection name="sound_std" source="r_sound_std"/>
              </output>
            </window-join>
            <window-compute name="sound_compute" collapse-updates="true">
              <schema>
                <fields>
                  <field name="ID" type="string" key="true"/>
                  <field name="timestamp" type="stamp"/>
                  <field name="sound" type="double"/>
                  <field name="sound_forecast" type="double"/>
                  <field name="sound_hh" type="double"/>
                  <field name="sound_h" type="double"/>
                  <field name="sound_l" type="double"/>
                  <field name="sound_ll" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[timestamp]]></field-expr>
                <field-expr><![CDATA[sound]]></field-expr>
                <field-expr><![CDATA[sound_forecast]]></field-expr>
                <field-expr><![CDATA[sound_forecast + (4 * sound_std)]]></field-expr>
                <field-expr><![CDATA[sound_forecast + (2.5 * sound_std)]]></field-expr>
                <field-expr><![CDATA[sound_forecast - (2.5 * sound_std)]]></field-expr>
                <field-expr><![CDATA[sound_forecast - (4 * sound_std)]]></field-expr>
              </output>
            </window-compute>
            <window-aggregate name="light_agg" collapse-updates="true">
              <schema>
                <fields>
                  <field name="location" type="string" key="true"/>
                  <field name="light_avg" type="double"/>
                  <field name="light_std" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[ESP_aAve(light)]]></field-expr>
                <field-expr><![CDATA[ESP_aStd(light)]]></field-expr>
              </output>
            </window-aggregate>
            <window-join name="light_join" collapse-updates="true">
              <join type="leftouter" no-regenerates="true">
                <conditions>
                  <fields left="location" right="location"/>
                </conditions>
              </join>
              <output>
                <field-selection name="ID" source="l_id"/>
                <field-selection name="timestamp" source="l_timestamp"/>
                <field-selection name="light" source="l_light"/>
                <field-selection name="light_forecast" source="r_light_avg"/>
                <field-selection name="light_std" source="r_light_std"/>
              </output>
            </window-join>
            <window-compute name="light_compute" collapse-updates="true">
              <schema>
                <fields>
                  <field name="id" type="string" key="true"/>
                  <field name="timestamp" type="stamp"/>
                  <field name="light" type="double"/>
                  <field name="light_forecast" type="double"/>
                  <field name="light_hh" type="double"/>
                  <field name="light_h" type="double"/>
                  <field name="light_l" type="double"/>
                  <field name="light_ll" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[timestamp]]></field-expr>
                <field-expr><![CDATA[light]]></field-expr>
                <field-expr><![CDATA[light_forecast]]></field-expr>
                <field-expr><![CDATA[light_forecast + (4 * light_std)]]></field-expr>
                <field-expr><![CDATA[light_forecast + (2.5 * light_std)]]></field-expr>
                <field-expr><![CDATA[light_forecast - (2.5 * light_std)]]></field-expr>
                <field-expr><![CDATA[light_forecast - (4 * light_std)]]></field-expr>
              </output>
            </window-compute>
            <window-aggregate name="humidity_agg" collapse-updates="true">
              <schema>
                <fields>
                  <field name="location" type="string" key="true"/>
                  <field name="humidity_avg" type="double"/>
                  <field name="humidity_std" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[ESP_aAve(humidity)]]></field-expr>
                <field-expr><![CDATA[ESP_aStd(humidity)]]></field-expr>
              </output>
            </window-aggregate>
            <window-join name="humidity_join" collapse-updates="true">
              <join type="leftouter" no-regenerates="true">
                <conditions>
                  <fields left="location" right="location"/>
                </conditions>
              </join>
              <output>
                <field-selection name="ID" source="l_id"/>
                <field-selection name="timestamp" source="l_timestamp"/>
                <field-selection name="humidity" source="l_humidity"/>
                <field-selection name="humidity_std" source="r_humidity_std"/>
                <field-selection name="humidity_forecast" source="r_humidity_avg"/>
              </output>
            </window-join>
            <window-compute name="humidity_compute" collapse-updates="true">
              <schema>
                <fields>
                  <field name="id" type="string" key="true"/>
                  <field name="timestamp" type="stamp"/>
                  <field name="humidity" type="double"/>
                  <field name="humidity_forecast" type="double"/>
                  <field name="humidity_hh" type="double"/>
                  <field name="humidity_h" type="double"/>
                  <field name="humidity_l" type="double"/>
                  <field name="humidity_ll" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[timestamp]]></field-expr>
                <field-expr><![CDATA[humidity]]></field-expr>
                <field-expr><![CDATA[humidity_forecast]]></field-expr>
                <field-expr><![CDATA[humidity_forecast + (4 * humidity_std)]]></field-expr>
                <field-expr><![CDATA[humidity_forecast + (2.5 * humidity_std)]]></field-expr>
                <field-expr><![CDATA[humidity_forecast - (2.5 * humidity_std)]]></field-expr>
                <field-expr><![CDATA[humidity_forecast - (4 * humidity_std)]]></field-expr>
              </output>
            </window-compute>
            <window-compute name="sound_residuals" collapse-updates="true">
              <schema>
                <fields>
                  <field name="id" type="string" key="true"/>
                  <field name="sound_residual" type="double"/>
                  <field name="sound" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[sound - sound_forecast]]></field-expr>
                <field-expr><![CDATA[sound]]></field-expr>
              </output>
            </window-compute>
            <window-compute name="light_residuals" collapse-updates="true">
              <schema>
                <fields>
                  <field name="id" type="string" key="true"/>
                  <field name="light" type="double"/>
                  <field name="light_residuals" type="double"/>
                </fields>
              </schema>
              <output>
                <field-expr><![CDATA[light]]></field-expr>
                <field-expr><![CDATA[light - light_forecast]]></field-expr>
              </output>
            </window-compute>
          </windows>
          <edges>
            <edge source="Data_Stream" target="retain_15records"/>
            <edge source="retain_15records" target="sound_agg"/>
            <edge source="Data_Stream" target="sound_join"/>
            <edge source="sound_agg" target="sound_join"/>
            <edge source="sound_join" target="sound_compute"/>
            <edge source="retain_15records" target="light_agg"/>
            <edge source="Data_Stream" target="light_join"/>
            <edge source="light_agg" target="light_join"/>
            <edge source="light_join" target="light_compute"/>
            <edge source="retain_15records" target="humidity_agg"/>
            <edge source="Data_Stream" target="humidity_join"/>
            <edge source="humidity_agg" target="humidity_join"/>
            <edge source="humidity_join" target="humidity_compute"/>
            <edge source="sound_join" target="sound_residuals"/>
            <edge source="light_join" target="light_residuals"/>
          </edges>
        </contquery>
      </contqueries>
    </project>
  </projects>
</engine>